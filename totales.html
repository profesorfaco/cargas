<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Proyecto de Título | Segundo semestre, 2023</title>
        <link href="style.css" rel="stylesheet" />
        <style>
            th:nth-child(1),
            td:nth-child(1) {
                text-align: center;
                width: 10%;
            }

            th:nth-child(3),
            td:nth-child(3) {
                width: 45%;
            }

            .last {
                background: rgb(249, 249, 249);
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <main>
            <h1>Proyecto de Título | Segundo semestre, 2023</h1>
            <p>La matrícula en quinto año supera las vacantes de primer año:</p>
            <table>
                <tr>
                    <th>Sem.</th>
                    <th>PRIMER AÑO</th>
                    <th>QUINTO AÑO</th>
                </tr>
                <tr>
                    <td>1ro.</td>
                    <td>65 estudiantes</td>
                    <td id="estudiantes1"></td>
                </tr>
                <tr>
                    <td>2do.</td>
                    <td>55 estudiantes</td>
                    <td id="estudiantes2"></td>
                </tr>
                <tr class="last">
                    <td>Total</td>
                    <td>120 estudiantes</td>
                    <td id="estudiantes3"></td>
                </tr>
            </table>
            <p>El número promedio de estudiantes por Profesor(a) Guía es cercano a 5:</p>
            <table id="docentes">
                <tr>
                    <th>Nº</th>
                    <th>Profesor(a) Guía</th>
                </tr>
            </table>            
        </main>
        <footer>
            <div>
                <a href="index.html">Seleccione guía…</a>
                <a href="niveles.html">Seleccione nivel…</a>
                <span>Desarrollado por <a href="https://faco.cl/" target="_blank">FACO</a></span>
            </div>
        </footer>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" integrity="sha512-dfX5uYVXzyU8+KHqj8bjo7UkOdg18PaOtpa48djpNbZHwExddghZ+ZmzWT06R5v6NSk3ZUfsH6FNEDepLx9hPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>
            var parciales = {
                tituloViejo: [],
                tituloUno: [],
                tituloDos: [],
            };
            var total;
            var profes = [];
            var docentesSinRepetir;
            const docentes = document.querySelector("#docentes");

            Papa.parse("https://raw.githubusercontent.com/profesorfaco/cargas/main/manual.csv", {
                download: true,
                header: true,
                complete: function (results) {
                    datos = results.data;
                    datos.forEach((d) => {
                        if (d.nombre_curso == "Proyecto de Título I") {
                            parciales.tituloUno.push(d);
                        }
                        if (d.nombre_curso == "Proyecto de Título II") {
                            parciales.tituloDos.push(d);
                        }
                        if (d.nombre_curso != "Proyecto de Título I" && d.nombre_curso != "Proyecto de Título II") {
                            parciales.tituloViejo.push(d);
                        }
                        profes.push(d.profe);
                    });
                    console.log(parciales);
                    console.log(profes);
                    total = parciales.tituloViejo.length + parciales.tituloUno.length + parciales.tituloDos.length;
                    console.log(total);
                    document.querySelector("#estudiantes1").innerHTML += `${parciales.tituloUno.length} estudiantes`;
                    document.querySelector("#estudiantes2").innerHTML += `${parciales.tituloViejo.length + parciales.tituloDos.length} estudiantes`;
                    document.querySelector("#estudiantes3").innerHTML += `${total} estudiantes`;
                    docentesSinRepetir = sinRepetir(profes);
                    console.log(docentesSinRepetir);
                    var todos = 0;
                    docentesSinRepetir.forEach(x => {
                        docentes.innerHTML += `<tr><td>${conteo(x)}</td><td>${x}</td></tr>`;
                        todos = todos + conteo(x);
                    })
                    docentes.innerHTML += `<tr class="last"><td>${(total/docentesSinRepetir.length).toFixed(1)}</td><td>Promedio</td></tr>`
                },
            });

            function sinRepetir(arr) {
                return arr.filter((item, index) => arr.indexOf(item) === index);
            }

            function conteo(x) {
                let numero = 0;
                datos.forEach(d => {
                    if (d.profe == x && d.estudiante != "-") { 
                        numero++;
                    }
                })
                return numero;
            }
        </script>
    </body>
</html>